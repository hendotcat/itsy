---
stages:
  - build
  - deploy

build:itsy:
  stage: build
  image: highvalleysystems/itsy:latest
  before_script:
    - cd itsy
  only:
    changes:
      - itsy/*
  script:
    - yarn --pure-lockfile
    - make itsy

deploy:studio:
  stage: deploy
  image: node:11-stretch
  dependencies:
    - build:itsy
  only:
    changes:
      - itsy/*
      - studio/*
  script:
    - yarn --pure-lockfile
    - yarn expo login -u $EXPO_USERNAME -p $EXPO_PASSWORD
    - yarn expo publish --non-interactive
  
deploy:website:
  stage: deploy
  image: node:11-stretch
  only:
    changes:
      - website/*
  script:
    - yarn --pure-lockfile
    - yarn gatsby build
    - yarn netlify deploy --prod --dir=public
